<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dropboxPopup.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dropboxPopup.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { DropboxAuth } from 'dropbox';

/**
 * This function is meant to run on page load and is in charge
 * of dispatching messages from the popup window back to the
 * main window.
 */
function dispatchResult() {
  const params = window.location.search;
  if (window.opener) {
    // send them to the opening window
    window.opener.postMessage(params);
    // close the popup
    window.close();
  }
}

window.addEventListener('load', dispatchResult);

const popupFeatures = 'toolbar=no, menubar=no, width=600, height=800, top=100, left=100';
const popupName = 'Dropbox OAuth';

/**
 * @class DropboxPopup
 * @classdesc The DropboxPopup class is to provide a simple popup window to preform OAuth in.
 * @param {object} options
 * @param {string} [options.clientId] - The client id for your app.
 * @param {string} [options.clientSecret] - The client secret for your app.
 * @param {string} [options.redirectUri] - The redirect Uri to return to once auth is complete.
 */
export default class DropboxPopup {
  constructor(options) {
    this.clientId = options.clientId;
    this.clientSecret = options.clientSecret;
    this.authObject = new DropboxAuth({
      clientId: this.clientId,
      clientSecret: this.clientSecret,
    });
    this.redirectUri = options.redirectUri;
  }

  /**
   * The main function to handle authentication via a popup window.
   *
   * @param {Function} callback - The callback function which will utilize the DropboxAuth object.
   * @returns {void}
   */
  authUser(callback) {
    window.removeEventListener('message', this.handleRedirect);
    this.callback = callback;
    this.callback.bind(this);
    const authUrl = this.authObject.getAuthenticationUrl(this.redirectUri, '', 'code', 'offline');
    const popupWindow = window.open(authUrl, popupName, popupFeatures);
    popupWindow.focus();

    window.addEventListener('message', (event) => this.handleRedirect(event), false);
  }

  /**
   * The function in charge of handling the redirect once the popup has completed.
   *
   * @param {MessageEvent} event - The incoming message from the popup window.
   * @returns {void}
   */
  handleRedirect(event) {
    const { data } = event;
    const urlParams = new URLSearchParams(data);
    const code = urlParams.get('code');
    this.authObject.getAccessTokenFromCode(this.redirectUri, code)
      .then((response) => {
        const { result } = response;
        this.authObject.setAccessToken(result.access_token);
        this.authObject.setRefreshToken(result.refresh_token);
        this.authObject.setAccessTokenExpiresAt(new Date(Date.now() + result.expires_in));
        this.callback(this.authObject);
      })
      .catch((error) => {
        throw error;
      });
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DropboxPopup.html">DropboxPopup</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-browser.html">browser</a></li></ul><h3>Global</h3><ul><li><a href="global.html#authUser">authUser</a></li><li><a href="global.html#dispatchResult">dispatchResult</a></li><li><a href="global.html#handleRedirect">handleRedirect</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Mon Oct 19 2020 22:06:58 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
